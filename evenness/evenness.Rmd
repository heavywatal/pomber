---
title: "Motif occurrence in S. pombe reference genome"
output:
  html_document:
runtime: shiny
---

Windows are 20000bp wide and not overlapped.

```{r library, echo=FALSE, message=FALSE}
library(stringr)
library(pipeR)
library(plyr)
library(dplyr)
library(ggplot2)
```

```{r input, echo=FALSE}
.cache = 'coefvar-ref.csv.gz'
.ref = read.table(.cache, header=TRUE, stringsAsFactors=FALSE) %>>% tbl_df()
.chrs = unique(as.character(.ref$chr))
names(.chrs) = .chrs
inputPanel(
    checkboxGroupInput('chr', 'Chromosome:', .chrs, 'total'),
    checkboxInput('exclude', 'Exclude repetitive region 688500:698500 in chr2, telomeres, and centromeres'),
    sliderInput('ubound', 'Display x max:', 5, 150, 100, 5)
)
```

塩基配列がランダムな並びであれば、あるモチーフが一定区間内にいくつ出現するか、という数は平均=分散のポアソン分布に従うと考えられる。
分散/平均 (variance-mean ratio) が小さいほど一様分布、1のときランダム分布、大きいほど集中分布になる。
下図の黒い直線は分散=平均を結んだもの。

```{r render, echo=FALSE}
filtered = reactive({
    .data = if (input$exclude) {
        read.table('coefvar-intermere.csv.gz', header=TRUE, stringsAsFactors=FALSE)
    } else {
        .ref
    }
    subset(.data, chr %in% input$chr) %>>%
        filter(mean < input$ubound)
})

.range = reactive(range(filtered()$mean))

renderPlot(filtered() %>>%
    ggplot(aes(mean, var))+
    geom_point(aes(colour=chr), alpha=0.6)+
    geom_line(data=data_frame(mean=.range(), var=.range()))+
    theme_bw(),
    width=720, height=600, res=96
)

if (FALSE) {
    renderPlot(filtered() %>>%
        ggplot(aes(mean, sd))+
        geom_point(aes(colour=chr), alpha=0.6)+
        geom_line(data=data_frame(mean=.range(), sd=.range()))+
        theme_bw()
    )
}

#renderDataTable(filtered())
renderDataTable(filtered(), options=list(order=list(c(5, 'asc'))))
```
